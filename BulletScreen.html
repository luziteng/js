<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发弹幕效果</title>
    <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon" />
    <style>
        .container{width:800px;margin:0 auto;padding-bottom:10px;background-color:#dfdfdf;}
        #barrage{position:relative;height:520px;margin-bottom:10px;background-color:#000;overflow:hidden;}
        #barrage .bar-item{position:absolute;left:100%;white-space:nowrap;}
        #msg{margin-left:10px;width:400px;height:30px;border:1px solid #999;border-right:none;box-sizing:border-box;vertical-align:middle;}
        #msg+button{padding:0 10px;height:30px;vertical-align:middle;}
    </style>
    <script src="./common.js"></script>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded",()=>{
            /*
				* 1.创建对象
					* 页面（仅有一个）
						属性：弹幕框、文本框、按钮
						方法:
							init:获取元素。
							send:点击按钮时,将文本框内容发送给弹幕对象（实例化弹幕对象）
					* 弹幕文字（多个）
						* 属性：随机颜色，速度，字体大小，垂直位置、内容
						* 方法：
							init 创建一个元素span，添加innerHTML，插入到barrage里面
							移动move:从右到左移动，当弹幕对象left到达一定的值，移除
							移除：让父元素把我删掉
			 */
            var page = {
                ele:"#barrage",
                msg:"#msg",
                init:function(){
                    this.el = document.querySelector(this.ele);
                    this.msg = document.querySelector(this.msg);
                    this.btn = this.msg.nextElementSibling;// nextElementSibling 属性返回指定元素之后的下一个兄弟元素（相同节点树层中的下一个元素节点）。
                    this.send();
                },
                send:function(){
                    // 这里的点击函数只能用箭头函数，普通函数的话this会指向btn;
                    this.btn.onclick = () =>{
                        let _msg = this.msg.value;
                        new Barrage(_msg).init(); // 执行自定义构造函数中的方法
                    }
                }
            };
            function Barrage(msg){
                this.color = getRandColor(); // common.js中的封装函数，随机获取颜色
                this.fontSize = getRandNum(14,20);
                this.top =getRandNum(20,document.querySelector("#barrage").offsetHeight/3) //在窗口上方三分一出显示
                this.msg = msg 
            }
            Barrage.prototype.init = function(){
				this.ele = document.createElement("span");
				this.ele.innerHTML = this.msg;
				// 随机颜色，字体大小，垂直位置
				this.ele.style.color = this.color;
				this.ele.style.fontSize = this.fontSize + 'px';
				this.ele.style.top = this.top + 'px';
				this.ele.classList.add("bar-item");
				page.el.appendChild(this.ele);
				this.move();
			}
			Barrage.prototype.move = function(){
				// myAnimate(this.ele,{left:-this.ele.offsetWidth},300,() => {
				// 	this.remove();
                // })
                // 这里动画效果使用匀速运动比较好
                myConstantSpeed(this.ele,-10,{left:-this.ele.offsetWidth},100,() => {
					this.remove();
                })
			}
			Barrage.prototype.remove = function(){
				this.ele.parentElement.removeChild(this.ele);
			}


            page.init();
            console.log(page)

        /*
        nextSibling 属性与 nextElementSibling 属性的差别：

        nextSibling 属性返回元素节点之后的兄弟节点（包括文本节点、注释节点）；
        nextElementSibling 属性只返回元素节点之后的兄弟元素节点（不包括文本节点、注释节点）；
        */     
        //无限发弹幕效果
        /*
        *1、首先我们要获取输入框，给输入框一个随机值
        *2、拿到发送按钮，执行点击事件
        *3、使用定时器不停的发送
        *斗鱼直播也适用哦，亲测有效
        */
        setInterval(()=>{
            document.querySelector('#msg').value='我是京城吴彦祖'+Math.round(Math.random()*10);
            this.msg.nextElementSibling.click()
        },2000)
    })
    </script>
</head>
<body>
    <div class="container">
		<div id="barrage"></div>
		<input type="text" id="msg"><button>发送</button>
	</div>
</body>
</html>